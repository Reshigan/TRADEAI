{"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/connection.js:816:11)\n    at NativeConnection.openUri (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/connection.js:791:11)\n    at async connectDB (/workspace/trade-ai-final/backend/src/config/database.js:12:7)\n    at async initializeDatabase (/workspace/trade-ai-final/backend/src/config/database.js:83:3)\n    at async startServer (/workspace/trade-ai-final/backend/src/server.js:25:5)","timestamp":"2025-09-06 08:25:28"}
{"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{},"setName":null,"stale":false,"type":"Unknown"},"stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/connection.js:816:11)\n    at NativeConnection.openUri (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/connection.js:791:11)\n    at async connectDB (/workspace/trade-ai-final/backend/src/config/database.js:12:7)\n    at async initializeDatabase (/workspace/trade-ai-final/backend/src/config/database.js:83:3)\n    at async startServer (/workspace/trade-ai-final/backend/src/server.js:25:5)","timestamp":"2025-09-06 08:25:38"}
{"code":"ERR_INVALID_ARG_TYPE","level":"error","message":"Failed to initialize Redis: The \"original\" argument must be of type function. Received undefined","stack":"TypeError [ERR_INVALID_ARG_TYPE]: The \"original\" argument must be of type function. Received undefined\n    at promisify (node:internal/util:409:3)\n    at CacheService.initialize (/workspace/trade-ai-final/backend/src/services/cacheService.js:43:24)\n    at initializeCache (/workspace/trade-ai-final/backend/src/services/cacheService.js:304:22)\n    at startServer (/workspace/trade-ai-final/backend/src/server.js:29:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-09-06 08:49:20"}
{"level":"error","message":"Operation `users.findOne()` buffering timed out after 10000ms","request":{"ip":"::1","method":"POST","url":"/api/auth/login"},"stack":"MongooseError: Operation `users.findOne()` buffering timed out after 10000ms\n    at Timeout.<anonymous> (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:185:23)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)","timestamp":"2025-09-06 08:53:38"}
{"level":"error","message":"Invalid login credentials","request":{"ip":"::1","method":"POST","url":"/api/auth/login"},"stack":"Error: Invalid login credentials\n    at Object.findByCredentials (/workspace/trade-ai-final/backend/src/services/mockDatabase.js:227:13)\n    at async /workspace/trade-ai-final/backend/src/controllers/authController.js:130:16","timestamp":"2025-09-06 09:02:51"}
{"level":"error","message":"user.save is not a function","request":{"ip":"::1","method":"POST","url":"/api/auth/login"},"stack":"TypeError: user.save is not a function\n    at /workspace/trade-ai-final/backend/src/controllers/authController.js:156:14","timestamp":"2025-09-06 09:04:53"}
{"level":"error","message":"user.save is not a function","request":{"ip":"::1","method":"POST","url":"/api/auth/login"},"stack":"TypeError: user.save is not a function\n    at /workspace/trade-ai-final/backend/src/controllers/authController.js:156:14","timestamp":"2025-09-06 09:05:05"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:54:31"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:56:07"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:56:07"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:56:07"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:57:17"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:57:17"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:57:17"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:57:17"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:57:17"}
{"level":"error","message":"Authentication error: User.findById(...).select is not a function","stack":"TypeError: User.findById(...).select is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:23:8)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:659:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /workspace/trade-ai-final/backend/node_modules/express-rate-limit/dist/index.cjs:576:5","timestamp":"2025-09-06 09:58:27"}
{"level":"error","message":"Authentication error: user.changedPasswordAfter is not a function","stack":"TypeError: user.changedPasswordAfter is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:56:14)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-09-06 09:59:37"}
{"level":"error","message":"Authentication error: user.changedPasswordAfter is not a function","stack":"TypeError: user.changedPasswordAfter is not a function\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:56:14)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-09-06 09:59:37"}
{"level":"error","message":"req.user.hasPermission is not a function","request":{"ip":"::1","method":"GET","url":"/api/promotions","userId":"507f1f77bcf86cd799439011"},"stack":"TypeError: req.user.hasPermission is not a function\n    at /workspace/trade-ai-final/backend/src/middleware/auth.js:127:19\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/workspace/trade-ai-final/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:175:3)\n    at router (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:47:12)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:65:5)","timestamp":"2025-09-06 10:00:42"}
{"level":"error","message":"req.user.hasPermission is not a function","request":{"ip":"::1","method":"GET","url":"/api/budgets","userId":"507f1f77bcf86cd799439011"},"stack":"TypeError: req.user.hasPermission is not a function\n    at /workspace/trade-ai-final/backend/src/middleware/auth.js:127:19\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/workspace/trade-ai-final/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:175:3)\n    at router (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:47:12)\n    at Layer.handle [as handle_request] (/workspace/trade-ai-final/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:328:13)\n    at /workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/workspace/trade-ai-final/backend/node_modules/express/lib/router/index.js:280:10)\n    at authenticateToken (/workspace/trade-ai-final/backend/src/middleware/auth.js:65:5)","timestamp":"2025-09-06 10:00:42"}
{"level":"error","message":"Operation `campaigns.find()` buffering timed out after 10000ms","request":{"ip":"::1","method":"GET","url":"/api/campaigns","userId":"507f1f77bcf86cd799439011"},"stack":"MongooseError: Operation `campaigns.find()` buffering timed out after 10000ms\n    at Timeout.<anonymous> (/workspace/trade-ai-final/backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:185:23)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)","timestamp":"2025-09-06 10:00:52"}
